#!/bin/rc
hget http://felloff.net/usr/cinap_lenrek/music \
	| awk '
/mp3/{
	sub(".*<a href=\"","")
	sub("\">.*\.mp3</a>","")
	s = $1
	sub("\.mp3$", "")
	if($1 ~ /[^0-9][0-9]+$/)
		sub("[0-9]+$", "")
	d[$1] = d[$1] " " h[$1]
	h[$1] = s
}END{
	for(i in h){
		if(d[i] != " "){
			split(d[i], a)
			for(j in a){
				if(system("test -f " a[j]) == 0){
					print a[j] >"/fd/2"
					system("rm " a[j])
				}
			}
		}
		if(system("test -f " h[i]) != 0)
			print "http://felloff.net/usr/cinap_lenrek/music/" h[i]
	}
}
' >list
{tee list | xargs -n 256 dw} && rm list
